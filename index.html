<!DOCTYPE html>
<html lang="kn">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>City Clinic Token Display</title>
  <style>
    html, body{
      height: 100%;
      margin: 0;
    }

    body {
      margin: 0; /* Remove default margin */
      font-family: 'Segoe UI', sans-serif; /* Set font style */
      background: linear-gradient(90deg, #53d0d2, #128f91); /* Background gradient */
      color: white; /* Default text color */
      overflow: hidden; /* Hide scrollbars */
    }

    .container {
      display: flex; /* Flex layout for main container */
      height: calc(100% - 50px); /* Full height */
      width: 100vw; /* Full width */
    }

    .left {
      width: 70%;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .left img {
      position: absolute; /* Position logo */
      top: 30px;
      left: 30px;
      width: 180px;
      height: auto;
      z-index: 1;
    }

    .left iframe {
      flex: 1;
      width: 100%; /* Full width video */
      border: none; /* Remove borders */
      border-bottom-right-radius: 50px;
    }

    .info-row {
      display: flex; /* Row of info boxes */
      justify-content: center;
      align-items: center;
      font-size: 36px;
      gap: 180px;
      color: #fff;
      padding: 20px;
      z-index: 2;
    }

    .info-box {
      width: 200px;
      text-align: center;
    }

    .right {
      width: 30%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      padding: 40px 20px;
}

    .token-label {
      font-size: 70px;
      font-weight: 600;
      letter-spacing: 2px;
      margin-bottom: 20px;
      color: #ffffff;
}

    .token-number {
      font-size: 280px;
      font-weight: 900;
      color: #ffffff;
      text-shadow: 0 0 5px #00ffff;
      margin-bottom: 20px;
}

    .token-number.blink {
      animation: blink 0.6s ease-in-out 3; /* Blinking animation */
    }

    .token-text {
      font-size: 70px;
      color: #ffffff;
      letter-spacing: 2px;
    }

    @keyframes blink {
      0%, 100% { opacity: 1; }
      50% { opacity: 0; }
    }

    .footer {
      position: fixed; /* Stick to bottom */
      bottom: 0;
      width: 100%;
      background: #128f91;
      color: #ffffff;
      font-size: 36px;
      overflow: hidden;
      white-space: nowrap;
      border-top: 2px solid black; /* Black line on top */
    }

    .scroll-text {
      display: inline-block;
      padding-left: 100%;
      animation: scroll-left 30s linear infinite; /* Scrolling text */
    }

    @keyframes scroll-left {
      0% { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }

    #fullscreenBox {
      position: fixed;
      top: 50px;
      left: 50%;
      transform: translateX(-50%);
      background: white;
      color: black;
      border-radius: 10px;
      padding: 20px 30px;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
      font-family: sans-serif;
      text-align: center;
      z-index: 9999;
      display: none;
    }

    #fullscreenBox button {
      padding: 10px 20px;
      font-size: 1.1em;
      background: #0078D7;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="left">
      <img src="logo.png" alt="City Clinic Logo"> <!-- Clinic logo -->
      <iframe id="ytVideo" allowfullscreen></iframe> <!-- YouTube video -->
      <div class="info-row">
        <div class="info-box">
          <div>üå°Ô∏è</div>
          <div id="temperature">--¬∞C</div> <!-- Temperature display -->
        </div>
        <div class="info-box">
          <div>üí®</div>
          <div id="wind">-- km/h</div> <!-- Wind speed display -->
        </div>
        <div class="info-box">
          <div id="dateClock">--:--</div> <!-- Time display -->
          <div id="dateAlt">-- --, ----</div> <!-- Date display -->
        </div>
      </div>
    </div>

    <div class="right">
      <div class="token-label">Now serving</div>
      <div class="token-number" id="tokenNumber">--</div> <!-- Token number -->
      <div class="token-text">Number</div>
    </div>
  </div>

  <div class="footer">
    <div class="scroll-text">
      üòÑ Welcome to City Clinic ‚Äì Kanavalli üè• ‚Ä¢ Opened Everyday ‚Ä¢ Morning 9:30‚Äì1:30 ‚Ä¢ Evening 6:30‚Äì10:30 ‚Ä¢ Stay healthy & safe! üíä
    </div>
  </div>

  <audio id="bellSound" src="bell.mp3" preload="auto"></audio> <!-- Bell sound -->

  <div id="fullscreenBox">
    <button onclick="openFullscreen()">üî≤ Go Full Screen</button> <!-- Fullscreen button -->
  </div>

  <!-- Firebase Scripts -->
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
  <script>
    // Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyC-dN8RtQkDE3eY5q4mQUYiJv9xQCuwnsk",
      authDomain: "cityclinictoken.firebaseapp.com",
      databaseURL: "https://cityclinictoken-default-rtdb.firebaseio.com/",
      projectId: "cityclinictoken",
      storageBucket: "cityclinictoken.appspot.com",
      messagingSenderId: "196394231581",
      appId: "1:196394231581:web:08b59c5f22608a9246d6d5"
    };
    
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    const tokenEl = document.getElementById('tokenNumber');
    const bellSound = document.getElementById('bellSound');
    
    let lastToken = null;
    let lastUpdate = null;

    // Listen for token updates
    database.ref('currentToken').on('value', (snapshot) => {
      const data = snapshot.val();
      if (data) {
        const newToken = data.token || '--';
        const updatedAt = data.updatedAt || 0;
        if (lastToken !== newToken || lastUpdate !== updatedAt) {
          lastToken = newToken;
          lastUpdate = updatedAt;

          // Play bell + number audio      
          bellSound.pause();
          bellSound.currentTime = 0;
          bellSound.play();

          const audio = new Audio(`https://xon0176.github.io/CityClinicToken/tokensounds/${newToken}.mp3`);
          audio.play();

          // Animate blink   
          tokenEl.classList.remove('blink');
          void tokenEl.offsetWidth;
          tokenEl.classList.add('blink');
        }
        tokenEl.textContent = newToken;
      }
    });

    // YouTube video loader
    const videoFrame = document.getElementById("ytVideo");
    database.ref('youtubeURL').on('value', (snapshot) => {
      const ytURL = snapshot.val();
      if (ytURL) {
        let videoId = "";
        if (ytURL.includes("youtu.be/")) {
          videoId = ytURL.split("youtu.be/")[1];
        } else if (ytURL.includes("watch?v=")) {
          videoId = ytURL.split("watch?v=")[1].split("&")[0];
        } else {
          videoId = ytURL;
        }
        const embedURL = `https://www.youtube.com/embed/${videoId}?autoplay=1&mute=1&loop=1&playlist=${videoId}`;
        videoFrame.src = embedURL;
      }
    });

    // Update date and time
    function updateTime() {
      const now = new Date();
      const time = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
      const dateAlt = now.toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' });
      document.getElementById("dateClock").textContent = time;
      document.getElementById("dateAlt").textContent = dateAlt;
    }
    setInterval(updateTime, 1000);
    updateTime();

    // Weather data
    const apiKey = 'ece698c5756c98857c463ddc98000798';
    const city = 'Kanavalli';
    async function fetchWeather() {
      try {
        const response = await fetch(`https://api.openweathermap.org/data/2.5/weather?q=${city}&appid=${apiKey}&units=metric`);
        const data = await response.json();
        document.getElementById("temperature").textContent = `${data.main.temp.toFixed(1)}¬∞C`;
        document.getElementById("wind").textContent = `${data.wind.speed.toFixed(1)} km/h`;
      } catch (error) {
        document.getElementById("temperature").textContent = `--¬∞C`;
        document.getElementById("wind").textContent = `-- km/h`;
      }
    }
    fetchWeather();
    setInterval(fetchWeather, 600000); // Update every 10 mins

    // Show full screen button on load
    window.onload = () => {
      const box = document.getElementById('fullscreenBox');
      box.style.display = 'block';
      setTimeout(() => {
        box.style.display = 'none';
      }, 10000);
    };

    function openFullscreen() {
      const el = document.documentElement;
      if (el.requestFullscreen) el.requestFullscreen();
      else if (el.webkitRequestFullscreen) el.webkitRequestFullscreen();
      else if (el.msRequestFullscreen) el.msRequestFullscreen();
      document.getElementById('fullscreenBox').style.display = 'none';
    }
  </script>
</body>
</html>